<?php
// +----------------------------------------------------------------------
// | Copyright (c) 2013 http://www.onethink.cn All rights reserved.
// +----------------------------------------------------------------------
// | Author: kerry.gao <1509699669@vip.qq.com> <http://weibo.com/coderzero>
// +----------------------------------------------------------------------
namespace Admin\Controller;
use Think\Controller;
use Think\Upload\Driver\Qiniu\QiniuStorage;

class GoodsController extends BaseController {
    public function index(){
    	$destination = M('destination');
    	$destinations = $destination->select();
    	$pagesize = C('BACKEND_PAGESIZE');
    	
    	$package = M('package');
    	$where = array();

    	$packageData = $package->where($where)->select();
    	$this->assign('packageData',$packageData);
    	$this->assign('destinations',$destinations);
        $this->display();
    }

    public function addGoods(){
    	$category = D('ProductCategory');
    	$destination = M('destination');
    	$destinations = $destination->select();
    	$categorys = $category->where(array('parent_id'=>0))->select();
    	$this->assign('categorys',$categorys);
    	$this->assign('destinations',$destinations);
    	$this->display();
    }

    public function getVendors(){
    	$arr = I();
        $dao = M();
        $data = array();
        if($arr['id']){
            $data = $dao->query("SELECT id,name from vendors where id in (SELECT vendors_id from vendors_category_relation where category_id = '%s')",$arr['id']);
        }
        $this->resultMsg('success', '获取成功',$data);
    }

    public function getServices(){
    	$arr = I();
    	$vid = $arr['id'];
    	$product = M('product');
    	$services = $product->field('id,name')->where(array('vendors_id'=>$vid))->select();
    	$this->resultMsg('success', '获取成功',$services);
    }
}
